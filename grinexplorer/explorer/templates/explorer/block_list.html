{% extends "base.html" %}

{% load static %}
{% load humanize %}
{% load grin %}
{% load shortnaturaltime %}

{% block content %}
  {% if block_list.exists %}
	<br>

	<br>

	{% if competing_chains > 1 %}
	  <div class="alert alert-danger" role="alert">
		<strong>Fork detected!</strong>
		We've detected {{ competing_chains | apnumber }} competing chains, forked at <a href="/block/{{ forked_at }}">Block {{ forked_at }}</a>. Stay wary!
	  </div>
	{% endif %}

	{% if block_list %}
	  <div class="row align-items-start">
		<div class="col">
		  <div class="block_detail_header, row">
			<img border="0" src="{% static "images/icons/cubes_32x32.png" %}" width="25" height="25" />
			<h4>&nbsp Blocks</h4>
		  </div>
		</div>
		<div class="col-sm-6 col-md-3" align="center">
		  {% if is_paginated %}
			<ul class="pagination justify-content-center">
			  {% if page_obj.has_previous %}
				<li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
			  {% else %}
				<li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
			  {% endif %}
			  <li class="page-item disabled">
				<a class="page-link" href="#">{{ page_obj.number }} / {{ paginator.num_pages }}</a>
			  </li>
			  {% if page_obj.has_next %}
				<li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
			  {% else %}
				<li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
			  {% endif %}
			</ul>
		  {% endif %}

	{% else %}
		  Sorry, there was an error fetching the list of blocks. Please try again later.
	{% endif %}
		</div>
	  </div>

	  <table class="table table-horizontal-bordered table-hover">
		<thead class="thead-light">
		  <tr>
			<th>Height</th>
			<th>Hash</th>
			<th>Age</th>
		  <th>Difficulty</th>
		  <th>Reward</th>
			<th># Kernels</th>
	        <th># TokenKernels</th>
		  </tr>
		</thead>
		<tbody>
		  {% for blk in block_list %}
			<tr>
			  <td><a href="/block/{{ blk.height }}" style="color:royalblue">{{ blk.height }}</a></td>
			  <td><a href="/block/{{ blk.hash }}" style="color:royalblue"><font face=monospace>{{ blk.hash }}</font></a></td>
			  <td>{{ blk.timestamp | shortnaturaltime }}</td>
			<td class="numeric">{{ blk.bit_difficulty | intcomma }}</td>
			<td>{{ blk.reward }}</td>
			  <td class="numeric" align="left">{{ blk.kernel_set.all.count }}</td>
			  <td class="numeric" align="left">{{ blk.tokenkernel_set.all.count }}</td>
			</tr>
		  {% endfor %}
		</tbody>
	  </table>
  {% else %}
	  <br><br>
	  <h1>Block Database is empty</h1>
	  <h2>Please run <code>./manage.py import_from_tip ...</code> to populate the database.</h2>
  {% endif %}
{% endblock %}
